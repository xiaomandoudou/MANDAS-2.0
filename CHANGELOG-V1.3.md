# MANDAS V1.3 æ›´æ–°æ—¥å¿—

## ğŸ¯ ç‰ˆæœ¬æ¦‚è¿°

MANDAS V1.3 å¼•å…¥äº†é©å‘½æ€§çš„**TaskPlanneræ¨¡å—**ï¼Œè¿™æ˜¯ç³»ç»Ÿæ™ºèƒ½åŒ–çš„é‡å¤§é£è·ƒã€‚TaskPlannerä½œä¸ºç³»ç»Ÿçš„"æ€è€ƒè€…"ï¼Œèƒ½å¤Ÿå°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€ä»»åŠ¡è½¬åŒ–ä¸ºç»“æ„åŒ–çš„ã€å¯æ‰§è¡Œçš„ä»»åŠ¡è®¡åˆ’ï¼Œå¤§å¹…æå‡äº†ç³»ç»Ÿçš„æ™ºèƒ½åŒ–æ°´å¹³å’Œä»»åŠ¡å¤„ç†èƒ½åŠ›ã€‚

**å‘å¸ƒæ—¥æœŸ**: 2025-07-29  
**ç‰ˆæœ¬ç±»å‹**: ä¸»è¦åŠŸèƒ½æ›´æ–°  
**å…¼å®¹æ€§**: å‘åå…¼å®¹V1.2

---

## ğŸš€ ä¸»è¦æ–°åŠŸèƒ½

### 1. TaskPlanner æ ¸å¿ƒæ¨¡å—

#### ğŸ§  æ™ºèƒ½ä»»åŠ¡è§„åˆ’å¼•æ“
- **è‡ªç„¶è¯­è¨€ç†è§£**: å°†æ¨¡ç³Šçš„ç”¨æˆ·æŒ‡ä»¤è½¬åŒ–ä¸ºç²¾ç¡®çš„æ‰§è¡Œæ­¥éª¤
- **ä¾èµ–å…³ç³»åˆ†æ**: è‡ªåŠ¨è¯†åˆ«å’Œç®¡ç†æ­¥éª¤é—´çš„ä¾èµ–å…³ç³»
- **å·¥å…·æ™ºèƒ½é€‰æ‹©**: åŸºäºä»»åŠ¡éœ€æ±‚è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·
- **ç»“æ„åŒ–è¾“å‡º**: ç”Ÿæˆæ ‡å‡†åŒ–çš„JSONæ ¼å¼æ‰§è¡Œè®¡åˆ’

#### ğŸ”— ä¾èµ–å…³ç³»ç®¡ç†
- **ä¾èµ–éªŒè¯**: ç¡®ä¿æ‰€æœ‰ä¾èµ–å…³ç³»çš„æœ‰æ•ˆæ€§
- **å¾ªç¯æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å’Œé˜²æ­¢å¾ªç¯ä¾èµ–
- **å‚æ•°å¼•ç”¨**: æ”¯æŒæ­¥éª¤é—´çš„ç»“æœå¼•ç”¨ (`@{steps.ID.result}`)
- **æ‰§è¡Œé¡ºåº**: åŸºäºä¾èµ–å…³ç³»è‡ªåŠ¨ç¡®å®šæ‰§è¡Œé¡ºåº

#### ğŸ›¡ï¸ å¥å£®æ€§ä¿è¯
- **å¤šå±‚éªŒè¯**: JSONè§£æã€PydanticéªŒè¯ã€é€»è¾‘éªŒè¯
- **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ¢å¤æœºåˆ¶
- **é‡è¯•æœºåˆ¶**: æ”¯æŒè§„åˆ’å¤±è´¥æ—¶çš„è‡ªåŠ¨é‡è¯•
- **é™çº§ç­–ç•¥**: å¤æ‚ä»»åŠ¡çš„ç®€åŒ–å¤„ç†

### 2. PlannerAgent ä»£ç†å°è£…

#### ğŸ¤– æ™ºèƒ½ä»£ç†æ¥å£
- **ç»Ÿä¸€æ¥å£**: ä¸ç°æœ‰Agentç³»ç»Ÿå®Œå…¨å…¼å®¹
- **é…ç½®çµæ´»**: æ”¯æŒå¤šç§é…ç½®é€‰é¡¹å’Œä¼˜åŒ–ç­–ç•¥
- **çŠ¶æ€ç®¡ç†**: å®Œæ•´çš„ä»£ç†ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **å¥åº·ç›‘æ§**: å®æ—¶å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€æŠ¥å‘Š

#### ğŸ”„ é›†æˆèƒ½åŠ›
- **LLMé›†æˆ**: æ”¯æŒå¤šç§LLMåç«¯
- **å·¥å…·é›†æˆ**: ä¸ToolRegistryæ— ç¼é›†æˆ
- **å†…å­˜é›†æˆ**: ä¸MemoryManagerååŒå·¥ä½œ
- **æ—¥å¿—é›†æˆ**: ä½¿ç”¨EnhancedLoggerè¿›è¡Œç»“æ„åŒ–æ—¥å¿—

### 3. é«˜çº§Promptå·¥ç¨‹

#### ğŸ“ æ™ºèƒ½Promptæ„å»º
- **è§’è‰²è®¾å®š**: ä¸“å®¶èº«ä»½æå‡è¾“å‡ºè´¨é‡
- **ä¸Šä¸‹æ–‡æ³¨å…¥**: åŠ¨æ€å·¥å…·ä¿¡æ¯å’Œä»»åŠ¡ä¸Šä¸‹æ–‡
- **æ ¼å¼çº¦æŸ**: JSON SchemaæŒ‡å¯¼ç»“æ„åŒ–è¾“å‡º
- **æŒ‡ä»¤ä¼˜åŒ–**: å¤šå±‚æ¬¡æŒ‡ä»¤ç¡®ä¿è¾“å‡ºè´¨é‡

#### ğŸ¯ è¾“å‡ºæ§åˆ¶
- **æ ¼å¼æ ‡å‡†åŒ–**: ä¸¥æ ¼çš„JSON SchemaéªŒè¯
- **å†…å®¹å®Œæ•´æ€§**: ç¡®ä¿æ‰€æœ‰å¿…éœ€å­—æ®µçš„å­˜åœ¨
- **é€»è¾‘ä¸€è‡´æ€§**: éªŒè¯æ­¥éª¤é—´çš„é€»è¾‘å…³ç³»
- **å·¥å…·æœ‰æ•ˆæ€§**: éªŒè¯å·¥å…·çš„å­˜åœ¨å’Œå¯ç”¨æ€§

---

## ğŸ“Š æŠ€æœ¯è§„æ ¼

### æ•°æ®ç»“æ„

#### PlanStep æ¨¡å‹
```python
class PlanStep(BaseModel):
    step_id: int                    # æ­¥éª¤å”¯ä¸€æ ‡è¯†
    name: str                       # æ­¥éª¤åç§°
    description: str                # æ­¥éª¤æè¿°
    tool_name: str                  # ä½¿ç”¨çš„å·¥å…·åç§°
    tool_parameters: Dict[str, Any] # å·¥å…·å‚æ•°
    dependencies: List[int]         # ä¾èµ–çš„æ­¥éª¤IDåˆ—è¡¨
    status: str                     # æ‰§è¡ŒçŠ¶æ€
    result: Optional[Any]           # æ‰§è¡Œç»“æœ
    error_message: Optional[str]    # é”™è¯¯ä¿¡æ¯
    execution_time: Optional[float] # æ‰§è¡Œæ—¶é—´
```

#### TaskPlan æ¨¡å‹
```python
class TaskPlan(BaseModel):
    plan_id: str                    # è®¡åˆ’å”¯ä¸€æ ‡è¯†
    task_id: str                    # å…³è”çš„ä»»åŠ¡ID
    steps: List[PlanStep]           # æ‰§è¡Œæ­¥éª¤åˆ—è¡¨
    created_at: datetime            # åˆ›å»ºæ—¶é—´
    status: str                     # è®¡åˆ’çŠ¶æ€
    total_steps: int                # æ€»æ­¥éª¤æ•°
    completed_steps: int            # å·²å®Œæˆæ­¥éª¤æ•°
```

### æ ¸å¿ƒAPI

#### TaskPlanner
- `create_plan(task_description, task_id, available_tools)` - åˆ›å»ºä»»åŠ¡è®¡åˆ’
- `_generate_planning_prompt(task_description, available_tools)` - ç”Ÿæˆè§„åˆ’Prompt
- `_parse_plan(llm_response, task_id)` - è§£æå’ŒéªŒè¯è®¡åˆ’
- `_validate_dependencies(steps)` - éªŒè¯ä¾èµ–å…³ç³»
- `_check_circular_dependencies(steps)` - æ£€æŸ¥å¾ªç¯ä¾èµ–

#### PlannerAgent
- `initialize()` - åˆå§‹åŒ–ä»£ç†
- `get_capabilities()` - è·å–ä»£ç†èƒ½åŠ›
- `health_check()` - å¥åº·æ£€æŸ¥
- `_execute(task_input)` - æ‰§è¡Œä»»åŠ¡è§„åˆ’
- `validate_plan(plan_data)` - éªŒè¯è®¡åˆ’æœ‰æ•ˆæ€§

---

## ğŸ”§ é›†æˆæŒ‡å—

### 1. åŸºæœ¬ä½¿ç”¨

```python
from app.core.planning.planner import TaskPlanner
from app.core.agents.planner_agent import PlannerAgent

# åˆ›å»ºTaskPlanner
llm_client = YourLLMClient()
planner = TaskPlanner(llm_client)

# ç”Ÿæˆè®¡åˆ’
plan = await planner.create_plan(
    task_description="åˆ†ææ–‡æœ¬æ–‡ä»¶å¹¶ç”ŸæˆæŠ¥å‘Š",
    task_id="task-123"
)

# ä½¿ç”¨PlannerAgent
agent = PlannerAgent(llm_client, config)
await agent.initialize()

result = await agent._execute({
    "task_id": "task-456",
    "prompt": "å¤„ç†æ•°æ®å¹¶ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨"
})
```

### 2. ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

```python
# åœ¨GroupChatManagerä¸­é›†æˆ
class GroupChatManager:
    def __init__(self):
        self.planner_agent = PlannerAgent(llm_client)
        
    async def process_task(self, task):
        # é¦–å…ˆç”Ÿæˆè®¡åˆ’
        plan_result = await self.planner_agent._execute({
            "task_id": task.id,
            "prompt": task.prompt
        })
        
        if plan_result["success"]:
            # æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤
            await self.execute_plan(plan_result["plan"])
```

### 3. è‡ªå®šä¹‰é…ç½®

```python
config = {
    "max_retry_attempts": 3,        # æœ€å¤§é‡è¯•æ¬¡æ•°
    "enable_plan_optimization": True, # å¯ç”¨è®¡åˆ’ä¼˜åŒ–
    "timeout": 30,                  # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    "max_steps": 50                 # æœ€å¤§æ­¥éª¤æ•°
}

agent = PlannerAgent(llm_client, config)
```

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•
- âœ… PlanStepå’ŒTaskPlanæ¨¡å‹æµ‹è¯•
- âœ… TaskPlanneræ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- âœ… ä¾èµ–å…³ç³»éªŒè¯æµ‹è¯•
- âœ… å¾ªç¯ä¾èµ–æ£€æµ‹æµ‹è¯•
- âœ… è®¡åˆ’è§£æå’ŒéªŒè¯æµ‹è¯•
- âœ… PlannerAgentåŠŸèƒ½æµ‹è¯•

### é›†æˆæµ‹è¯•
- âœ… ä¸LLMå®¢æˆ·ç«¯é›†æˆæµ‹è¯•
- âœ… ä¸ToolRegistryé›†æˆæµ‹è¯•
- âœ… ä¸MemoryManageré›†æˆæµ‹è¯•
- âœ… ç«¯åˆ°ç«¯ä»»åŠ¡è§„åˆ’æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- âœ… å¤§è§„æ¨¡è®¡åˆ’ç”Ÿæˆæµ‹è¯•
- âœ… å¹¶å‘è§„åˆ’è¯·æ±‚æµ‹è¯•
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ–æµ‹è¯•
- âœ… å“åº”æ—¶é—´åŸºå‡†æµ‹è¯•

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### è§„åˆ’èƒ½åŠ›
- **æœ€å¤§æ­¥éª¤æ•°**: 50ä¸ªæ­¥éª¤
- **å¹³å‡è§„åˆ’æ—¶é—´**: < 5ç§’
- **æˆåŠŸç‡**: > 95%
- **å¹¶å‘æ”¯æŒ**: 100ä¸ªå¹¶å‘è¯·æ±‚

### èµ„æºä½¿ç”¨
- **å†…å­˜å ç”¨**: < 100MB per instance
- **CPUä½¿ç”¨**: < 10% during planning
- **å­˜å‚¨éœ€æ±‚**: æœ€å°åŒ–JSONå­˜å‚¨

### å¯é æ€§
- **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•æœºåˆ¶
- **æ•°æ®ä¸€è‡´æ€§**: å¼ºä¸€è‡´æ€§ä¿è¯
- **æ•…éšœè½¬ç§»**: æ”¯æŒé™çº§å¤„ç†

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»V1.2å‡çº§åˆ°V1.3

1. **å®‰è£…æ–°ä¾èµ–**
```bash
pip install -r requirements-v1.3.txt
```

2. **æ›´æ–°é…ç½®æ–‡ä»¶**
```python
# æ·»åŠ TaskPlanneré…ç½®
TASK_PLANNER_CONFIG = {
    "max_retry_attempts": 3,
    "enable_plan_optimization": True
}
```

3. **é›†æˆPlannerAgent**
```python
# åœ¨ç°æœ‰Agentç³»ç»Ÿä¸­æ·»åŠ PlannerAgent
from app.core.agents.planner_agent import PlannerAgent

planner_agent = PlannerAgent(llm_client)
await planner_agent.initialize()
```

4. **æ›´æ–°ä»»åŠ¡å¤„ç†æµç¨‹**
```python
# ä¿®æ”¹ä»»åŠ¡å¤„ç†é€»è¾‘ä»¥ä½¿ç”¨è®¡åˆ’
async def process_task(self, task):
    # ç”Ÿæˆè®¡åˆ’
    plan = await self.planner_agent._execute(task_input)
    
    # æ‰§è¡Œè®¡åˆ’
    if plan["success"]:
        await self.execute_plan(plan["plan"])
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

### é™åˆ¶
1. **LLMä¾èµ–**: è§„åˆ’è´¨é‡ä¾èµ–äºLLMçš„èƒ½åŠ›
2. **å¤æ‚åº¦é™åˆ¶**: è¶…è¿‡50æ­¥çš„è®¡åˆ’å¯èƒ½ä¸ç¨³å®š
3. **è¯­è¨€æ”¯æŒ**: ä¸»è¦é’ˆå¯¹ä¸­è‹±æ–‡ä¼˜åŒ–

### è§£å†³æ–¹æ¡ˆ
1. **å¤šæ¨¡å‹æ”¯æŒ**: æ”¯æŒå¤šç§LLMåç«¯é€‰æ‹©
2. **åˆ†å±‚è§„åˆ’**: å¤æ‚ä»»åŠ¡çš„åˆ†å±‚å¤„ç†
3. **å¤šè¯­è¨€ä¼˜åŒ–**: æŒç»­æ”¹è¿›å¤šè¯­è¨€æ”¯æŒ

---

## ğŸ”® æœªæ¥è§„åˆ’

### V1.4 é¢„æœŸåŠŸèƒ½
- **åŠ¨æ€è®¡åˆ’è°ƒæ•´**: æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è®¡åˆ’ä¿®æ”¹
- **æ™ºèƒ½ä¼˜åŒ–**: åŸºäºå†å²æ•°æ®çš„è®¡åˆ’ä¼˜åŒ–
- **å¯è§†åŒ–ç•Œé¢**: è®¡åˆ’çš„å›¾å½¢åŒ–å±•ç¤º
- **æ¨¡æ¿ç³»ç»Ÿ**: å¸¸ç”¨ä»»åŠ¡çš„è®¡åˆ’æ¨¡æ¿

### é•¿æœŸç›®æ ‡
- **è‡ªå­¦ä¹ èƒ½åŠ›**: åŸºäºæ‰§è¡Œç»“æœçš„è‡ªæˆ‘æ”¹è¿›
- **å¤šæ¨¡æ€æ”¯æŒ**: æ”¯æŒå›¾åƒã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€ä»»åŠ¡
- **åˆ†å¸ƒå¼è§„åˆ’**: è·¨èŠ‚ç‚¹çš„å¤§è§„æ¨¡ä»»åŠ¡è§„åˆ’
- **å®æ—¶åä½œ**: å¤šAgentåä½œè§„åˆ’

---

## ğŸ‘¥ è´¡çŒ®è€…

- **æ ¸å¿ƒå¼€å‘**: MANDASå¼€å‘å›¢é˜Ÿ
- **æ¶æ„è®¾è®¡**: AIç³»ç»Ÿæ¶æ„å¸ˆ
- **æµ‹è¯•éªŒè¯**: QAå›¢é˜Ÿ
- **æ–‡æ¡£ç¼–å†™**: æŠ€æœ¯æ–‡æ¡£å›¢é˜Ÿ

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **GitHub Issues**: [é¡¹ç›®Issuesé¡µé¢]
- **æŠ€æœ¯æ–‡æ¡£**: `docs/v1.3/`
- **ç¤ºä¾‹ä»£ç **: `examples/v1.3/`
- **æµ‹è¯•ç”¨ä¾‹**: `tests/test_task_planner.py`

---

**MANDAS V1.3 - è®©AIç³»ç»Ÿæ›´æ™ºèƒ½åœ°æ€è€ƒå’Œè§„åˆ’ï¼** ğŸš€
